bundle:
  name: banking_default_model_bundle

# -------------------------------------------------------------------
# Default workspace and sync settings
# -------------------------------------------------------------------
sync:
  include:
    - "*.yml"
    - "src/*.ipynb"
    - "src/*.py"

# -------------------------------------------------------------------
# Define environments for dev and prod
# -------------------------------------------------------------------
targets:
  default:
    mode: development
    workspace:
      host: https://dbc-64239bfe-e47d.cloud.databricks.com
      root_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}
      file_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}/files
    run_as:
      user_name: ${workspace.current_user.userName}  # same PAT-based auth for POC

  prod:
    mode: production
    workspace:
      host: https://dbc-57661877-0140.cloud.databricks.com
      root_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}
      file_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}/files
    run_as:
      user_name: ${workspace.current_user.userName}  # same PAT-based auth for POC

# -------------------------------------------------------------------
# Shared resources (identical for all environments)
# -------------------------------------------------------------------
resources:
  jobs:
    Banking_Model_Register:
      name: Banking_Model_Register
      tasks:
        - task_key: register_model
          description: "Registers the latest MLflow run into the model registry"
          notebook_task:
            notebook_path: ${workspace.file_path}/src/ModelRegistry
            source: WORKSPACE
          timeout_seconds: 1800

    Banking_Default_Inference:
      name: Banking_Default_Inference
      tasks:
        - task_key: inference
          description: "Runs batch inference using the champion model"
          notebook_task:
            notebook_path: ${workspace.file_path}/src/Deploy
            source: WORKSPACE
          timeout_seconds: 3600
      schedule:
        quartz_cron_expression: "0 0 9 * * ?"
        timezone_id: Pacific/Auckland
